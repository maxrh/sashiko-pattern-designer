---
import Layout from '../layouts/Layout.astro';
import PatternDesigner from '../components/PatternDesigner.jsx';
import ErrorBoundary from '../components/ErrorBoundary.jsx';
---

<Layout title="Sashiko Pattern Designer">
	<ErrorBoundary client:only="react">
		<PatternDesigner client:only="react" />
	</ErrorBoundary>
	
	<!-- PWA Service Worker Registration -->
	<script is:inline>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', async () => {
				try {
					const registration = await navigator.serviceWorker.register('/sw.js', { 
						scope: '/',
						updateViaCache: 'none'
					});
					
					console.log('SW registered:', registration);
					
					// Store version for display in UI
					const storeVersion = async () => {
						try {
							const response = await fetch('/version.json');
							if (response.ok) {
								const versionData = await response.json();
								localStorage.setItem('app_version', JSON.stringify(versionData));
								console.log('Version:', versionData.version);
							}
						} catch (error) {
							console.log('Could not load version:', error.message);
						}
					};
					
					// Store version for UI display
					setTimeout(storeVersion, 1000);
					
				} catch (error) {
					console.log('SW registration failed:', error);
				}
			});
		}
	</script>
</Layout>
